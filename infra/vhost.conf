<VirtualHost *:443>
        ServerName chat.heungkukfire.co.kr
        ServerAlias chat1.heungkukfire.co.kr
        DocumentRoot /var/www/html

        <Directory "/var/www/html">
                Options FollowSymLinks
                ReWriteEngine On
                AllowOverride ALL
                Require all granted
        </Directory>

        <Location /happytalk/upload>
                ProxyPass !
        </Location>
        Alias /happytalk/upload /DATA/hftalk/upload
        <Directory /DATA/hftalk/upload>
                Options FollowSymLinks
                AllowOverride None
                Require all granted
        </Directory>

        SSLEngine on
        SSLProtocol All -SSLv2 -SSLv3
        SSLCipherSuite ECDHE-RSA-AES128-SHA256:AES128-GCM-SHA256:AES128-SHA:AES256-SHA:!RC4:HIGH:!MD5:!aNULL:!EDH
        SSLCertificateFile /etc/httpd/ssl/STAR.heungkukfire.co.kr.crt
        SSLCertificateKeyFile /etc/httpd/ssl/STAR.heungkukfire.co.kr.key
        SSLCACertificateFile /etc/httpd/ssl/chainca.crt

        UseCanonicalName on
        ProxyRequests Off
        ProxyPreserveHost On

        <Proxy balancer://openCluster>
                BalancerMember http://10.110.121.81:8001 route=jvm0101 keepalive=on retry=60
                BalancerMember http://10.110.121.82:8001 route=jvm0201 keepalive=on status=+H retry=0
                #ProxySet lbmethod=byrequests
                ProxySet stickysession=JSESSIONID
        </Proxy>
        <Proxy balancer://closeCluster>
                BalancerMember http://10.110.121.81:8001 route=jvm0101 keepalive=on retry=60
                BalancerMember http://10.110.121.82:8001 route=jvm0201 keepalive=on status=+H retry=0
                #ProxySet lbmethod=byrequests
                ProxySet stickysession=JSESSIONID
                Require all denied
                Require ip 10.111.14 10.11.110 10.170.101 10.170.100 10.178.101 10.11.101 \
                                10.170.55 10.170.101.140 183.99.65.176
        </Proxy>
        <Proxy balancer://wsCluster>
                BalancerMember ws://10.110.121.81:8001 route=jvm0101 keepalive=on retry=60
                BalancerMember ws://10.110.121.82:8001 route=jvm0201 keepalive=on status=+H retry=0
                #ProxySet lbmethod=byrequests
                ProxySet stickysession=JSESSIONID
        </Proxy>

        RewriteEngine on
        RewriteCond %{HTTP:Upgrade} =websocket
        RewriteRule /(.*) balancer://wsCluster/$1 [P,L]
        #RewriteCond %{HTTP:Upgrade} !=websocket
        #RewriteRule /(.*) balancer://openCluster/$1 [P,L]

        #<Location /happytalk/loginPage>
        #       Require all denied
        #       Require ip 10.111.14 10.11.110 10.170.101 10.170.100 10.178.101 10.11.101 10.170.55 10.170.101.140
        #</Location>
        #<Location /happybot>
        #       Require all denied
        #       Require ip 10.111.14 10.11.110 10.170.101 10.170.100 10.178.101 10.11.101 10.170.55
        #</Location>

        ProxyPass        /happybot balancer://closeCluster/happybot
        ProxyPassReverse /happybot balancer://closeCluster/happybot

        ProxyPass        /api-hook/swagger-ui.html balancer://closeCluster/api-hook/swagger-ui.html
        ProxyPassReverse /api-hook/swagger-ui.html balancer://closeCluster/api-hook/swagger-ui.html
        ProxyPass        /api-hook balancer://openCluster/api-hook
        ProxyPassReverse /api-hook balancer://openCluster/api-hook

        #ProxyPass        /happytalk/ws balancer://wsCluster/happytalk/ws
        #ProxyPassReverse /happytalk/ws balancer://wsCluster/happptalk/ws
        ProxyPass        /happytalk/upload !
        ProxyPass        /happytalk/loginPage balancer://closeCluster/happytalk/loginPage
        ProxyPassReverse /happytalk/loginPage balancer://closeCluster/happytalk/loginPage
        ProxyPass        / balancer://openCluster/
        ProxyPassReverse / balancer://openCluster/

        Header set Access-Control-Allow-Origin "*"
        #Header always append X-Frame-Options SAMEORIGIN
        Header unset Server

        ErrorLog /LOG/webhk/httpd/chat-live-error.log
        CustomLog /LOG/webhk/httpd/chat-live-access.log combined
</VirtualHost>
<VirtualHost *:80>
        ServerName chat.heungkukfire.co.kr
        ServerAlias chat1.heungkukfire.co.kr
        RewriteEngine On
        RewriteCond %{HTTPS} off
        RewriteRule .* https://%{HTTP_HOST}%{REQUEST_URI} [P,R,L]
</VirtualHost>
<VirtualHost *:8080>
        ServerName localhost
        DocumentRoot /var/www/html

        <Directory "/var/www/html">
                Options FollowSymLinks
                ReWriteEngine On
                AllowOverride ALL
                Require all granted
        </Directory>

        UseCanonicalName on
        ProxyRequests On
        ProxyPreserveHost On

        ErrorLog /LOG/webhk/httpd/proxy-error.log
        CustomLog /LOG/webhk/httpd/proxy-access.log combined
</VirtualHost>
