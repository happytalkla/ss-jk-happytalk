<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BotBlock">

	<select id="select" resultType="BotBlock">
		/* BotBlock.select */
		select id,
		    auto_block_id,
		    auto_call_api_url,
		    to_char(cont) as cont,
		    default_actions_use_yn,
		    default_condition_block_id,
		    deletable_yn,
		    deploy_yn,
		    end_category_id,
		    fallback_block_id,
		    intent,
		    <if test="nameTriggerCodeYn != null and nameTriggerCodeYn eq 'Y'.toString()">
		    CASE WHEN trigger_code is null THEN name
		    ELSE name || '<![CDATA[<Div>]]>(' || trigger_code || ')<![CDATA[</Div>]]>' END name,
		    </if>
		    <if test="nameTriggerCodeYn == null or nameTriggerCodeYn eq 'N'.toString()">
		    name,
		    </if>
		    scenario_id,
		    skill_display_type,
		    skill_id,
		    trigger_code,
		    trigger_code as pre_trigger_code,
		    type,
		    use_yn,
		    orient
		from shfda.tb_bot_block
		<where>
			1=1
			<if test="id != null">
			and id = #{id}
			</if>
			<if test="idList != null">
				and id in
				<foreach collection="idList" item="item" open="(" separator="," close=")">
					#{item} 
				</foreach>
			</if>
			<if test="autoBlockId != null">
			and auto_block_id = #{autoBlockId}
			</if>
			<if test="autoCallApiUrl != null">
			and auto_call_api_url = #{autoCallApiUrl}
			</if>
			<if test="cont != null">
			and cont = #{cont}
			</if>
			<if test="defaultActionsUseYn != null">
			and default_actions_use_yn = #{defaultActionsUseYn}
			</if>
			<if test="defaultConditionBlockId != null">
			and default_condition_block_id = #{defaultConditionBlockId}
			</if>
			<if test="deletableYn != null">
			and deletable_yn = #{deletableYn}
			</if>
			<if test="deployYn != null">
			and deploy_yn = #{deployYn}
			</if>
			<if test="endCategoryId != null">
			and end_category_id = #{endCategoryId}
			</if>
			<if test="fallbackBlockId != fallbackBlockId">
			and num = #{fallbackBlockId}
			</if>				
			<if test="intent != null">
			and intent = #{intent}
			</if>
			<if test="name != null">
			and name like '%'||#{name}||'%'
			</if>				
			<if test="scenarioId != null">
			and scenario_id = #{scenarioId}
			</if>
			<if test="skillDisplayType != null">
			and skill_display_type = #{skillDisplayType}
			</if>
			<if test="skillId != null">
			and skill_id = #{skillId}
			</if>	
			<if test="triggerCode != null">
			and trigger_code = #{triggerCode}
			</if>	
			<if test="type != null">
			and type = #{type}
			</if>	
			<if test="useYn != null">
			and use_yn = #{useYn}
			</if>
			<if test="preTriggerCode != null and preTriggerCode != ''">
			and trigger_code != #{preTriggerCode}
			</if>													
		</where>

		<if test="orderby != null">
		order by ${orderby}
		</if>
	</select>
	<select id="selectId" resultType="Long">
	select shfda.seq_bot_block.nextval from dual
	</select>
	<update id="save">
		/* BotBlock.save */
		merge into shfda.tb_bot_block
		using dual
		on (id = #{id})

		when not matched then
		insert
		(
		    id,
		    auto_block_id,
		    auto_call_api_url,
		    cont,
		    default_actions_use_yn,
		    default_condition_block_id,
		    deletable_yn,
		    deploy_yn,
		    end_category_id,
		    fallback_block_id,
		    intent,
		    modified,
		    modifier,
		    name,
		    scenario_id,
		    skill_display_type,
		    skill_id,
		    trigger_code,
		    type,
		    use_yn
		    <if test="orient != null">
		    ,orient
		    </if>
		)
		values
		(
			 #{id}
			, #{autoBlockId}
			, #{autoCallApiUrl}
			, #{cont}
			, #{defaultActionsUseYn}
			, #{defaultConditionBlockId}
			, #{deletableYn}
			, #{deployYn}
			, #{endCategoryId}
			, #{fallbackBlockId}
			, #{intent}					
			, sysdate
			, 1
			, #{name}
			, #{scenarioId}
			, #{skillDisplayType}
			, #{skillId}			
			, #{triggerCode}
			, #{type}
			, #{useYn}
			<if test="orient != null">	
			, #{orient}
			</if>		
		)

		when matched then
		update
		set
		    auto_block_id = #{autoBlockId},		
		    auto_call_api_url = #{autoCallApiUrl},	
		    cont = #{cont},
		    default_actions_use_yn = #{defaultActionsUseYn},
		    default_condition_block_id = #{defaultConditionBlockId},
		    deletable_yn = #{deletableYn},
		    deploy_yn = #{deployYn},
		    end_category_id = #{endCategoryId},
		    fallback_block_id = #{fallbackBlockId},
		    intent = #{intent},
		    modified = sysdate,	
		    modifier = 1,
		    name = #{name},
		    scenario_id = #{scenarioId},
		    skill_display_type = #{skillDisplayType},
		    skill_id = #{skillId},
		    trigger_code = #{triggerCode},
		    type = #{type},
		    use_yn = #{useYn}
		    <if test="orient != null">
		    ,orient = #{orient}
		    </if>
		where
			id = #{id}
	</update>

	<update id="delete">
		/* BotBlock.delete */
		delete from shfda.tb_bot_block
		where
			<if test="id != null">
			id = #{id}
			</if>
	</update>
</mapper>
